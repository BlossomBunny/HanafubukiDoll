<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Studio Manager - HanafubukiDoll</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        .tab-btn.active { border-bottom: 3px solid #f472b6; color: #f472b6; }
        .bg-status-waiting { background-color: #f3f4f6; color: #374151; }
        .bg-status-notified { background-color: #d1fae5; color: #065f46; }
        /* Toggle Styles from previous version */
        .switch { position: relative; display: inline-block; width: 34px; height: 20px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 34px; }
        .slider:before { position: absolute; content: ""; height: 14px; width: 14px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: #f472b6; }
        input:checked + .slider:before { transform: translateX(14px); }
    </style>
</head>
<body class="bg-[#fdfbfb] min-h-screen">
    
    <header class="sticky top-0 z-50 bg-white/80 backdrop-blur-md border-b border-pink-100 p-4">
        <div class="max-w-7xl mx-auto flex items-center justify-between">
            <div class="flex gap-8 items-center">
                <h1 class="font-black text-xl tracking-tighter">üê∞ Studio Admin</h1>
                <nav class="flex gap-6">
                    <button onclick="switchTab('workbench')" id="tab-workbench" class="tab-btn active text-xs font-black uppercase tracking-widest pb-1">Workbench</button>
                    <button onclick="switchTab('waitlist')" id="tab-waitlist" class="tab-btn text-xs font-black uppercase tracking-widest pb-1">Waitlist</button>
                </nav>
            </div>
            
            <div class="flex gap-4 items-center bg-pink-50 p-2 px-4 rounded-2xl border border-pink-100">
                <div class="flex items-center gap-2"><span class="text-[9px] font-bold">Faceups</span><label class="switch"><input type="checkbox" id="toggle-faceups" onchange="updateServiceStatus('faceups', this.checked)"><span class="slider"></span></label></div>
                <div class="flex items-center gap-2"><span class="text-[9px] font-bold">Mani</span><label class="switch"><input type="checkbox" id="toggle-manicures" onchange="updateServiceStatus('manicures', this.checked)"><span class="slider"></span></label></div>
                <div class="flex items-center gap-2"><span class="text-[9px] font-bold">Eyes</span><label class="switch"><input type="checkbox" id="toggle-eyes" onchange="updateServiceStatus('eyes', this.checked)"><span class="slider"></span></label></div>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto p-6">
        <div id="view-workbench" class="space-y-6">
             <div id="workbench-table-container"></div>
        </div>

        <div id="view-waitlist" class="hidden space-y-6">
            <h2 class="text-2xl font-black tracking-tighter">Waitlist Management</h2>
            <div class="bg-white rounded-3xl border border-pink-50 shadow-sm overflow-hidden">
                <table class="w-full text-left">
                    <thead class="bg-gray-50 text-[10px] font-black uppercase text-gray-400">
                        <tr>
                            <th class="p-6">Date</th>
                            <th class="p-6">Email</th>
                            <th class="p-6">Requested</th>
                            <th class="p-6">Status</th>
                            <th class="p-6 text-right">Action</th>
                        </tr>
                    </thead>
                    <tbody id="waitlistTableBody"></tbody>
                </table>
            </div>
        </div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        const SUPABASE_URL = 'https://hxqxinfdeyprkuvvyqet.supabase.co';
        const SUPABASE_KEY = 'sb_publishable_J6MAvzpyVHd_zo6PtEcnzQ_L6AVEDZE';
        const _supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        function switchTab(tab) {
            document.getElementById('view-workbench').classList.toggle('hidden', tab !== 'workbench');
            document.getElementById('view-waitlist').classList.toggle('hidden', tab !== 'waitlist');
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(`tab-${tab}`).classList.add('active');
            if(tab === 'waitlist') fetchWaitlist();
        }

        async function fetchWaitlist() {
            const { data } = await _supabase.from('waitlist').select('*').order('created_at', { ascending: false });
            const tbody = document.getElementById('waitlistTableBody');
            tbody.innerHTML = data.map(item => `
                <tr class="border-b border-pink-50">
                    <td class="p-6 text-xs text-gray-400">${new Date(item.created_at).toLocaleDateString()}</td>
                    <td class="p-6 font-bold text-sm">${item.email}</td>
                    <td class="p-6"><span class="text-[10px] font-black uppercase text-pink-500">${item.service_requested}</span></td>
                    <td class="p-6"><span class="px-3 py-1 rounded-full text-[9px] font-black uppercase bg-status-${item.status}">${item.status}</span></td>
                    <td class="p-6 text-right">
                        <button onclick="notifyClient('${item.email}', '${item.id}')" class="bg-pink-400 text-white px-4 py-2 rounded-xl text-xs font-bold">Send Notification Email</button>
                    </td>
                </tr>
            `).join('');
        }

        function notifyClient(email, id) {
            const subject = "HanafubukiDoll: Slots are now open! ‚ô°";
            const body = `Hi there!\n\nYou're receiving this because you joined the waitlist for our services. We're happy to say slots are now available!\n\nPlease fill out the booking form here to secure your spot: [YOUR_WEBSITE_URL]\n\nWarmly,\nDani & Jas`;
            
            // This opens the default email app with the pre-filled message
            window.location.href = `mailto:${email}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
            
            // Mark as notified in DB
            _supabase.from('waitlist').update({ status: 'notified' }).eq('id', id).then(() => fetchWaitlist());
        }

        // Logic for toggles and workbench remains same as previous script...
    </script>
</body>
</html>
