<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Book a Slot - HanafubukiDoll</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="style.css">
    <style>
        .step-hidden { display: none; }
        .option-card { transition: all 0.3s ease; border: 2px solid #fdf2f8; }
        .option-card:hover { border-color: #f472b6; background: #fff1f2; }
        .addon-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 10px; }
    </style>
</head>
<body class="bg-[#fdfbfb] min-h-screen p-4 md:p-10">
    <div class="mesh-bg"></div>

    <div class="max-w-3xl mx-auto relative z-10">
        
        <div id="entryChoice" class="glass-card p-10 text-center space-y-8 animate-fadeIn">
            <h1 class="text-4xl font-black tracking-tighter">Connect with the Studio</h1>
            <p class="text-[var(--text-muted)] italic">How can Dani & Jas help you today?</p>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <a href="mailto:Admin@hanafubukidoll.co.uk" class="option-card p-8 rounded-3xl text-center">
                    <span class="text-4xl">‚úâÔ∏è</span>
                    <h3 class="font-bold mt-4">General Inquiry</h3>
                    <p class="text-[10px] uppercase tracking-widest opacity-50 mt-2">Questions / Collabs</p>
                </a>
                <button onclick="startBooking()" class="option-card p-8 rounded-3xl text-center">
                    <span class="text-4xl">üé®</span>
                    <h3 class="font-bold mt-4">Book a Slot</h3>
                    <p class="text-[10px] uppercase tracking-widest opacity-50 mt-2">Full Questionnaire</p>
                </button>
            </div>
        </div>

        <form id="bookingForm" class="step-hidden space-y-8">
            
            <div class="glass-card p-8 space-y-6">
                <h2 class="text-2xl font-black tracking-tighter">1. Artist Details</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <input type="text" id="custName" placeholder="Full Name" required class="w-full p-4 rounded-xl border border-pink-100 outline-none focus:ring-2 ring-pink-200">
                    <input type="text" id="socialHandle" placeholder="Social Media Handle (@...)" class="w-full p-4 rounded-xl border border-pink-100 outline-none">
                    <input type="email" id="custEmail" placeholder="Email Address (Required)" required class="w-full p-4 rounded-xl border border-pink-100 outline-none md:col-span-2">
                    <input type="text" id="dollSculpt" placeholder="Doll Company & Sculpt (e.g. Smartdoll Mirai)" required class="w-full p-4 rounded-xl border border-pink-100 outline-none md:col-span-2">
                </div>
            </div>

            <div class="glass-card p-8 space-y-10">
                <h2 class="text-2xl font-black tracking-tighter">2. Service Selection</h2>

                <div class="space-y-4">
                    <label class="block text-xs font-black uppercase tracking-widest opacity-40">Face-Up Options</label>
                    <select id="faceupBase" class="w-full p-4 rounded-xl border border-pink-100 bg-white" onchange="toggleAddons('faceupAddons', this.value)">
                        <option value="None">None</option>
                        <option value="Standard Face-Up">Standard Face-Up</option>
                        <option value="Face-Up + Smartdoll Head">Face-Up + Smartdoll Head</option>
                        <option value="Face-Up + Dollfie Dream Head">Face-Up + Dollfie Dream Head</option>
                    </select>
                    <div id="faceupAddons" class="step-hidden p-4 bg-pink-50/50 rounded-xl space-y-3">
                        <p class="text-[10px] font-bold uppercase opacity-50">Add-ons:</p>
                        <div class="addon-grid">
                            <label class="text-xs flex items-center gap-2"><input type="checkbox" value="Eyelashes" class="service-check"> Eyelashes</label>
                            <label class="text-xs flex items-center gap-2"><input type="checkbox" value="Piercings" class="service-check"> Piercings</label>
                            <label class="text-xs flex items-center gap-2"><input type="checkbox" value="Modifications" class="service-check"> Modifications</label>
                        </div>
                    </div>
                </div>

                <div class="space-y-4 border-t border-pink-50 pt-6">
                    <label class="block text-xs font-black uppercase tracking-widest opacity-40">Manicure Options</label>
                    <select id="maniBase" class="w-full p-4 rounded-xl border border-pink-100 bg-white" onchange="toggleAddons('maniAddons', this.value)">
                        <option value="None">None</option>
                        <option value="Standard Manicure">Standard Manicure</option>
                        <option value="Acrylic Manicure">Acrylic Manicure</option>
                        <option value="Smartdoll Decora Hands">Smartdoll Decora Hands</option>
                        <option value="Dollfie Dream Decora Hands">Dollfie Dream Decora Hands</option>
                    </select>
                    <div id="maniAddons" class="step-hidden p-4 bg-pink-50/50 rounded-xl space-y-3">
                        <div class="addon-grid">
                            <label class="text-xs flex items-center gap-2"><input type="checkbox" value="Pedicure" class="service-check"> + Pedicure</label>
                        </div>
                    </div>
                </div>

                <div class="space-y-4 border-t border-pink-50 pt-6">
                    <label class="block text-xs font-black uppercase tracking-widest opacity-40">Body Work</label>
                    <div class="addon-grid">
                        <label class="text-xs flex items-center gap-2"><input type="checkbox" value="Face/Body Mods" class="service-check"> Face/Body Mods</label>
                        <label class="text-xs flex items-center gap-2"><input type="checkbox" value="Tattoos/Blushing" class="service-check"> Tattoos/Blushing</label>
                    </div>
                </div>

                <div class="space-y-4 border-t border-pink-50 pt-6">
                    <label class="block text-xs font-black uppercase tracking-widest opacity-40">Eye Options</label>
                    <select id="eyeBase" class="w-full p-4 rounded-xl border border-pink-100 bg-white">
                        <option value="None">None</option>
                        <option value="Follow-Me Eyes">Follow-Me Eyes</option>
                        <option value="Glitter Follow-Me Eyes">Glitter Follow-Me Eyes</option>
                        <option value="Custom Follow-Me Eyes">Custom Follow-Me Eyes</option>
                    </select>
                </div>
            </div>

            <div class="glass-card p-8 space-y-6">
                <h2 class="text-2xl font-black tracking-tighter">3. Concept & References</h2>
                <textarea id="designNotes" placeholder="Describe your vision (colors, personality, specific requests)..." class="w-full p-6 rounded-2xl border border-pink-100 h-40 outline-none"></textarea>
                
                <div class="p-6 border-2 border-dashed border-pink-100 rounded-2xl text-center">
                    <input type="file" id="fileUpload" multiple class="hidden">
                    <button type="button" onclick="document.getElementById('fileUpload').click()" class="text-pink-400 font-bold hover:underline">
                        Click to upload Reference Images ‚ô°
                    </button>
                    <p id="fileCount" class="text-[10px] mt-2 opacity-40">No files selected</p>
                </div>
                <div class="glass-card p-8 border-2 border-pink-200 bg-pink-50/20 space-y-4">
    <h2 class="text-xl font-black tracking-tighter flex items-center gap-2">
        <span>üìú</span> Terms of Service
    </h2>
    
    <div class="h-48 overflow-y-auto p-4 bg-white/80 rounded-xl border border-pink-100 text-[11px] leading-relaxed text-gray-600 shadow-inner">
        <p class="font-bold mb-2">Please read carefully before booking:</p>
        <ul class="list-disc pl-4 space-y-2">
            <li><strong>Payment:</strong> Full payment or the first installment of layaway must be made within 48 hours of invoice No work can commennce without payment.</li>
            <li><strong>Refunds:</strong> No refunds are provided once work has commenced on the doll.</li>
            <li><strong>Shipping:</strong> Clients are responsible for all shipping costs and customs fees. Studio is not liable for loss or damage during transit.</li>
            <li><strong>Artist Creative Freedom:</strong> By booking, you acknowledge the HanafubukiDoll style. Major changes requested after the face-up is complete may incur extra fees.</li>
            <li><strong>Materials:</strong> We use high-quality and professional pastels/paints and seal with MSC UV Cut to help with the longevity of your doll. We are not responsible for natural colour changes due to aging or stains from dark clothing.</li>
            <li><strong>Communication:</strong> Updates are provided via email or social media at major milestones (Base, Detail, Finish).</li>
        </ul>
    </div>

    <label class="flex items-start gap-3 cursor-pointer group">
        <input type="checkbox" id="tosCheck" required class="mt-1 w-5 h-5 accent-pink-500 rounded border-pink-300">
        <span class="text-xs font-bold text-gray-700 group-hover:text-pink-600 transition-colors">
            I have read and agree to the HanafubukiDoll Terms of Service. ‚ô°
        </span>
    </label>
</div>

                <button type="submit" id="submitBtn" class="w-full bg-[var(--accent-pink)] text-white py-5 rounded-3xl font-black text-lg shadow-xl hover:brightness-110 active:scale-95 transition-all">
                    Submit Commission Request ‚ú®
                </button>
            </div>
        </form>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        const SUPABASE_URL = 'https://hxqxinfdeyprkuvvyqet.supabase.co';
        const SUPABASE_KEY = 'sb_publishable_J6MAvzpyVHd_zo6PtEcnzQ_L6AVEDZE';
        const _supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        function startBooking() {
            document.getElementById('entryChoice').classList.add('step-hidden');
            document.getElementById('bookingForm').classList.remove('step-hidden');
        }

        function toggleAddons(id, value) {
            const el = document.getElementById(id);
            if (value !== 'None') el.classList.remove('step-hidden');
            else el.classList.add('step-hidden');
        }

        document.getElementById('fileUpload').addEventListener('change', (e) => {
            document.getElementById('fileCount').innerText = `${e.target.files.length} files selected`;
        });

       document.getElementById('bookingForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    
    // Safety check: Is ToS checked?
    if (!document.getElementById('tosCheck').checked) {
        alert("Please agree to the Terms of Service to continue.");
        return;
    }

    const btn = document.getElementById('submitBtn');
    btn.innerText = "Processing Agreement... ‚ú®";
    btn.disabled = true;

            // 1. Collect all selected services into one array
            const selectedServices = [];
            
            // Add Base choices if not None
            if(document.getElementById('faceupBase').value !== 'None') selectedServices.push(document.getElementById('faceupBase').value);
            if(document.getElementById('maniBase').value !== 'None') selectedServices.push(document.getElementById('maniBase').value);
            if(document.getElementById('eyeBase').value !== 'None') selectedServices.push(document.getElementById('eyeBase').value);

            // Add Checkbox choices
            document.querySelectorAll('.service-check:checked').forEach(check => {
                selectedServices.push(check.value);
            });

            // 2. Handle Image Uploads (Simplified for brevity, assuming existing bucket logic)
            const files = document.getElementById('fileUpload').files;
            const imageUrls = [];
            for (const file of files) {
                const fileName = `${Date.now()}-${file.name}`;
                const { data } = await _supabase.storage.from('references').upload(fileName, file);
                if (data) {
                    const { data: urlData } = _supabase.storage.from('references').getPublicUrl(fileName);
                    imageUrls.push(urlData.publicUrl);
                }
            }

            // 3. Send to Supabase (Including ToS)
    const { error } = await _supabase.from('commissions').insert([{
        customer_name: document.getElementById('custName').value,
        customer_email: document.getElementById('custEmail').value,
        social_handle: document.getElementById('socialHandle').value,
        doll_sculpt: document.getElementById('dollSculpt').value,
        services_list: selectedServices,
        notes: document.getElementById('designNotes').value,
        image_urls: imageUrls,
        tos_agreed: true, // Mark that they agreed
        status: 'inquiry'
    }]);

    if (!error) {
        alert("Success! Your request and agreement have been logged. ‚ô°");
        window.location.reload();
    } else {
        alert("Error: " + error.message);
        btn.disabled = false;
        btn.innerText = "Submit Commission Request ‚ú®";
    }
});
    </script>
</body>
</html>
