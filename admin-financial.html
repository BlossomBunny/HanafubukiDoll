<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Financials | HanafubukiDoll Aesthetic Studio</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="global-utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="global-style.css">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        .nav-btn { @apply px-5 py-2 rounded-full font-bold text-sm transition-all; }
        .nav-btn-pink { @apply bg-pink-50 text-pink-500 hover:bg-pink-100; }
        .nav-btn-mint { @apply bg-emerald-50 text-emerald-600 hover:bg-emerald-100; }
        .glass-card { @apply bg-white/70 backdrop-blur-md border border-white/20 rounded-[2rem] shadow-sm; }
    </style>
</head>
<body class="bg-[#fdfbfb]">
    <div class="mesh-bg"></div>

    <nav class="p-4 md:p-6 sticky top-0 z-50 bg-white/80 backdrop-blur-md border-b border-pink-50">
        <div class="max-w-6xl mx-auto flex flex-col md:flex-row justify-between items-center gap-4">
            <div class="text-xl md:text-2xl font-black tracking-tighter">
                <span class="bounce-bunny">üê∞</span> HanafubukiDoll üå∏
            </div>
            <div id="adminNav" class="flex flex-wrap justify-center gap-2 md:gap-4">
                <a href="admin-index.html" class="nav-btn nav-btn-pink">Dashboard ‚ô°</a>
                <a href="admin-workbench.html" class="nav-btn nav-btn-mint">Workbench ‚ô°</a>
                <a href="admin-planner.html" class="nav-btn nav-btn-pink">Planner ‚ô°</a>
                <a href="admin-inventory.html" class="nav-btn nav-btn-mint">Inventory ‚ô°</a>
                <a href="admin-financial.html" class="nav-btn nav-btn-pink border-2 border-pink-200">Financials ‚ô°</a>
                <button onclick="handleLogout()" class="nav-btn nav-btn-mint opacity-50">Logout ‚èª</button>
            </div>
        </div>
    </nav>

    <div class="glass-card p-6 mb-8 bg-gradient-to-r from-pink-50 to-emerald-50 border-none">
    <div class="flex flex-col md:flex-row justify-between items-center gap-4">
        <div class="flex-1 w-full">
            <div class="flex justify-between mb-2">
                <span class="text-[10px] font-black uppercase text-gray-500 tracking-widest">Tax Year Progress</span>
                <span id="daysRemaining" class="text-[10px] font-black uppercase text-pink-500"></span>
            </div>
            <div class="w-full bg-white/50 rounded-full h-3 overflow-hidden border border-pink-100">
                <div id="yearProgressBar" class="bg-pink-400 h-full transition-all duration-1000" style="width: 0%"></div>
            </div>
        </div>
    </div>
</div>
   <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
    <div class="lg:col-span-2 glass-card p-6 bg-white/50 border-none flex flex-col justify-center">
        <div class="flex justify-between mb-2">
            <span class="text-[10px] font-black uppercase text-gray-500 tracking-widest">Trading Allowance Tracker (¬£1k Limit)</span>
            <span id="allowanceStatus" class="text-[10px] font-black uppercase text-emerald-500 font-mono"></span>
        </div>
        <div class="w-full bg-gray-100 rounded-full h-2 overflow-hidden">
            <div id="allowanceBar" class="bg-emerald-400 h-full transition-all duration-1000" style="width: 0%"></div>
        </div>
        <p id="allowanceText" class="text-[9px] text-gray-400 mt-2 uppercase font-bold italic"></p>
    </div>

    <div id="strategyCard" class="glass-card p-6 border-2 border-dashed border-pink-100 flex flex-col items-center justify-center text-center">
        <p class="text-[9px] font-black uppercase text-gray-400 mb-1">Recommended Tax Strategy</p>
        <p id="strategyResult" class="text-xs font-black text-pink-500 uppercase italic">Calculating...</p>
    </div>
</div>
    <main class="max-w-6xl mx-auto p-4 md:p-10 space-y-10">
        <div id="financial-stats" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-10">
    <div class="glass-card p-6 animate-pulse bg-gray-50 h-32"></div>
    <div class="glass-card p-6 animate-pulse bg-gray-50 h-32"></div>
    <div class="glass-card p-6 animate-pulse bg-gray-50 h-32"></div>
    <div class="glass-card p-6 animate-pulse bg-gray-50 h-32"></div>
</div>
        <div id="financial-stats" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
            </div>
<div class="glass-card p-8 mb-8 bg-gradient-to-br from-blue-50/50 to-pink-50/50 border-none shadow-inner">
    <div class="flex flex-col md:flex-row justify-between items-center gap-6">
        <div class="space-y-2 text-center md:text-left">
            <h3 class="text-[11px] font-black uppercase tracking-[0.2em] text-blue-500">The Tax Pot</h3>
            <p class="text-4xl font-black text-gray-800 italic" id="taxPotValue">¬£0.00</p>
            <p class="text-[10px] text-gray-400 font-bold uppercase tracking-tighter">Amount to set aside in savings</p>
        </div>
        
        <div class="flex-1 w-full max-w-md space-y-4">
            <div class="flex justify-between text-[10px] font-black uppercase text-gray-400">
                <span>Current Progress</span>
                <span id="taxPotPercent">0% Saved</span>
            </div>
            <div class="w-full bg-white/50 rounded-full h-4 p-1 shadow-sm border border-white">
                <div id="taxPotBar" class="bg-blue-400 h-full rounded-full transition-all duration-1000 shadow-lg" style="width: 0%"></div>
            </div>
            <p class="text-[9px] text-center text-gray-400 italic">Based on 20% Income Tax + 6% Class 4 NI (if applicable)</p>
        </div>
    </div>
</div>
        <div class="glass-card p-8 bg-white/80">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xs font-black uppercase text-gray-400 tracking-widest">Revenue vs Expenses</h3>
                <select id="taxYearFilter" onchange="renderfinancials()" class="text-[10px] font-bold border-none bg-pink-50 rounded-lg p-2 outline-none text-pink-500 cursor-pointer">
                    <option value="2025-26">Tax Year 25/26</option>
                    <option value="2024-25">Tax Year 24/25</option>
                </select>
            </div>
            <div class="h-[350px]">
                <canvas id="revenueChart"></canvas>
            </div>
        </div>

<div class="glass-card p-8">
    <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
        <div>
            <h3 class="text-xs font-black uppercase text-gray-400 tracking-widest">Business Expenses</h3>
            <p class="text-[9px] text-gray-400 mt-1 uppercase font-bold italic">Self-Assessment Records</p>
        </div>
        <div class="flex gap-2">
            <button onclick="exportToCSV()" class="nav-btn nav-btn-pink text-[10px] shadow-sm flex items-center gap-2">
                <span>üíæ</span> Export CSV
            </button>
            <button onclick="openExpenseModal()" class="nav-btn nav-btn-mint text-[10px] shadow-sm flex items-center gap-2">
                <span>+</span> Log Expense
            </button>
        </div>
    </div>

    <div id="expense-pills" class="flex flex-wrap gap-2 mb-8"></div>
    
    </div>
            <div class="overflow-x-auto">
                <table class="w-full text-left">
                    <thead>
                        <tr class="text-[10px] uppercase text-gray-400 border-b border-pink-50">
                            <th class="pb-4 pl-2">Date</th>
                            <th class="pb-4">Category</th>
                            <th class="pb-4">Description</th>
                            <th class="pb-4 text-right">Amount</th>
                            <th class="pb-4 text-center">Receipt</th>
                            <th class="pb-4 text-center">Action</th>
                        </tr>
                    </thead>
                    <tbody id="expense-tbody" class="text-sm">
                        </tbody>
                </table>
            </div>
        </div>
    </main>

    <script>
        let revenueChart = null;
async function renderfinancials() {
    const taxYearFilter = document.getElementById('taxYearFilter');
    if (!taxYearFilter) return;

    const taxYear = taxYearFilter.value;
    const [startYear] = taxYear.split('-').map(Number);
    const startDate = new Date(startYear, 3, 6); 
    const endDate = new Date(startYear + 1, 3, 5);

    // 1. Fetch Data
    const [incomeRes, expenseRes] = await Promise.all([
        _supabase.from('commissions').select('total_price, created_at, shipping_cost, payments'),
        _supabase.from('studio_expenses').select('*').order('date', { ascending: false })
    ]);

    if (incomeRes.error || expenseRes.error) {
        console.error("Fetch error:", incomeRes.error || expenseRes.error);
        return;
    }

    // 2. Filter Expenses by Tax Year
    const filteredExpenses = expenseRes.data.filter(e => {
        const d = new Date(e.date);
        return d >= startDate && d <= endDate;
    });

    // 3. Process Commissions & JSON Payments Logic
    let totalIncomeInYear = 0;
    let totalBookedInYear = 0;
    let autoShippingInYear = 0;

    incomeRes.data.forEach(comm => {
        const commDate = new Date(comm.created_at);
        
        // Count booked value/shipping if commission was created this year
        if (commDate >= startDate && commDate <= endDate) {
            totalBookedInYear += (Number(comm.total_price) || 0);
            autoShippingInYear += (Number(comm.shipping_cost) || 0);
        }

        // Check JSON payments array for money received THIS tax year
        if (Array.isArray(comm.payments)) {
            comm.payments.forEach(p => {
                const pDate = new Date(p.date);
                if (pDate >= startDate && pDate <= endDate) {
                    totalIncomeInYear += (Number(p.amount) || 0);
                }
            });
        }
    });

    // 4. Core Calculations
    const totalOut = filteredExpenses.reduce((sum, e) => sum + (Number(e.amount) || 0), 0) + autoShippingInYear;
    const netProfit = totalIncomeInYear - totalOut;

    // HMRC Reserve Logic
    const taxPot = netProfit > 1000 ? netProfit * 0.20 : 0; 
    const class4NI = (netProfit > 12570) ? (netProfit - 12570) * 0.06 : 0;
    const totalTaxNeeded = taxPot + class4NI;

    const pendingRevenue = totalBookedInYear - totalIncomeInYear;

    // 5. Update Allowance Tracker & Strategy
    const allowanceLimit = 1000;
    const allowancePercent = Math.min((totalBookedInYear / allowanceLimit) * 100, 100);
    
    const allowanceBar = document.getElementById('allowanceBar');
    const strategyResult = document.getElementById('strategyResult');
    const allowanceStatus = document.getElementById('allowanceStatus');

    if (allowanceBar) allowanceBar.style.width = `${allowancePercent}%`;
    if (allowanceStatus) allowanceStatus.innerText = `¬£${totalBookedInYear.toLocaleString()} / ¬£1,000`;

    if (strategyResult) {
        if (totalBookedInYear >= allowanceLimit) {
            strategyResult.innerText = totalOut > 1000 ? "Strategy: Claim Actual Expenses üßæ" : "Strategy: Use ¬£1,000 Trading Allowance üí°";
            strategyResult.className = "text-xs font-black text-pink-500 uppercase italic";
        } else {
            strategyResult.innerText = "Status: Hobby Mode üß∏";
            strategyResult.className = "text-xs font-black text-emerald-500 uppercase italic";
        }
    }

    // 6. Update Stats Grid
    document.getElementById('financial-stats').innerHTML = `
        <div class="glass-card p-6 border-l-4 border-pink-400">
            <p class="text-[9px] font-black uppercase text-gray-400">Cash Received</p>
            <p class="text-2xl font-black italic">¬£${totalIncomeInYear.toLocaleString()}</p>
        </div>
        <div class="glass-card p-6 border-l-4 border-rose-400">
            <p class="text-[9px] font-black uppercase text-gray-400">Total Expenses</p>
            <p class="text-2xl font-black italic text-rose-500">¬£${totalOut.toLocaleString()}</p>
        </div>
        <div class="glass-card p-6 border-l-4 border-emerald-400 bg-emerald-50/20">
            <p class="text-[9px] font-black uppercase text-gray-400">Net Profit</p>
            <p class="text-2xl font-black italic text-emerald-600">¬£${netProfit.toLocaleString()}</p>
        </div>
        <div class="glass-card p-6 border-l-4 border-blue-400 bg-blue-50/20">
            <p class="text-[9px] font-black uppercase text-gray-400">Pending Revenue</p>
            <p class="text-2xl font-black italic text-blue-600">¬£${pendingRevenue.toLocaleString()}</p>
        </div>
        <div class="glass-card p-6 border-l-4 border-gray-400 bg-gray-50/50 lg:col-span-4 mt-2">
             <div class="flex justify-between items-center">
                <div>
                    <p class="text-[9px] font-black uppercase text-gray-400">Est. Tax & NI Reserve</p>
                    <p class="text-xl font-black italic text-gray-700">¬£${totalTaxNeeded.toLocaleString()}</p>
                </div>
                <p class="text-[7px] text-gray-400 uppercase text-right leading-tight">
                    20% Income Tax applied after ¬£1k profit.<br>NI Class 4 applied after ¬£12,570 profit.
                </p>
             </div>
        </div>
    `;

    // 7. Update Tax Pot Visuals
    const taxPotValueEl = document.getElementById('taxPotValue');
    const taxPotBar = document.getElementById('taxPotBar');
    const taxPotPercent = document.getElementById('taxPotPercent');

    if (taxPotValueEl) {
        taxPotValueEl.innerText = `¬£${totalTaxNeeded.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
        const intensity = netProfit > 0 ? Math.min((totalTaxNeeded / netProfit) * 100, 100) : 0;
        if (taxPotBar) taxPotBar.style.width = `${intensity}%`;
        if (taxPotPercent) taxPotPercent.innerText = `${intensity.toFixed(0)}% of Profit`;
    }

    // 8. Category Pills
    const catTotals = filteredExpenses.reduce((acc, curr) => {
        acc[curr.category] = (acc[curr.category] || 0) + Number(curr.amount);
        return acc;
    }, {});

    document.getElementById('expense-pills').innerHTML = Object.entries(catTotals).map(([cat, amt]) => `
        <div class="bg-white border border-pink-100 rounded-xl px-4 py-2 shadow-sm">
            <p class="text-[8px] font-black uppercase text-gray-400">${cat}</p>
            <p class="text-xs font-black text-gray-700">¬£${amt.toFixed(2)}</p>
        </div>
    `).join('');

    // 9. Table Rendering
    const expenseBody = document.getElementById('expense-tbody');
    expenseBody.innerHTML = filteredExpenses.length ? filteredExpenses.map(e => `
        <tr class="border-b border-pink-50/50 hover:bg-white/50 transition-colors">
            <td class="py-4 pl-2 text-[11px] font-bold text-gray-500">${new Date(e.date).toLocaleDateString()}</td>
            <td class="py-4"><span class="px-2 py-1 rounded-md bg-gray-100 text-[9px] font-black uppercase text-gray-400">${e.category}</span></td>
            <td class="py-4 text-xs font-bold text-gray-700">${e.description}</td>
            <td class="py-4 text-right text-xs font-black text-rose-500">¬£${Number(e.amount).toFixed(2)}</td>
            <td class="py-4 text-center">${e.reciept_url ? `<a href="${e.reciept_url}" target="_blank">üìé</a>` : '‚àÖ'}</td>
            <td class="py-4 text-center">
                <button onclick="deleteExpense('${e.id}')" class="text-gray-300 hover:text-rose-500">√ó</button>
            </td>
        </tr>
    `).join('') : `<tr><td colspan="6" class="py-10 text-center text-gray-300 italic text-xs">No expenses logged.</td></tr>`;

    // 10. Chart
    if (typeof initRevenueChart === 'function') {
        initRevenueChart(incomeRes.data, filteredExpenses);
    }
}

function initRevenueChart(incomeData, expenses) {
    const ctx = document.getElementById('revenueChart').getContext('2d');
    if (window.revenueChartInstance) window.revenueChartInstance.destroy();

    const labels = ["Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec", "Jan", "Feb", "Mar"];
    const incData = new Array(12).fill(0);
    const expData = new Array(12).fill(0);

    // Parse payments for chart (by actual payment date)
    incomeData.forEach(comm => {
        if (Array.isArray(comm.payments)) {
            comm.payments.forEach(p => {
                let m = new Date(p.date).getMonth() - 3;
                if (m < 0) m += 12;
                if (m >= 0 && m < 12) incData[m] += (Number(p.amount) || 0);
            });
        }
    });

    expenses.forEach(e => {
        let m = new Date(e.date).getMonth() - 3;
        if (m < 0) m += 12;
        if (m >= 0 && m < 12) expData[m] += (Number(e.amount) || 0);
    });

    window.revenueChartInstance = new Chart(ctx, {
        type: 'line',
        data: {
            labels: labels,
            datasets: [
                { label: 'Income', data: incData, borderColor: '#f472b6', backgroundColor: 'rgba(244, 114, 182, 0.1)', fill: true, tension: 0.4 },
                { label: 'Expenses', data: expData, borderColor: '#94a3b8', borderDash: [5, 5], tension: 0.4 }
            ]
        },
        options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } } }
    });
}
        function openExpenseModal() {
            document.getElementById('expenseForm').reset();
            document.getElementById('expDate').valueAsDate = new Date();
            document.getElementById('expenseModal').classList.remove('hidden');
        }

        function closeExpenseModal() {
            document.getElementById('expenseModal').classList.add('hidden');
        }

        async function saveExpense() {
            const btn = document.getElementById('btnSaveExpense');
            const file = document.getElementById('expFile').files[0];
            btn.disabled = true;
            btn.innerText = "Processing... ‚ú®";

            try {
                let receiptUrl = null;
                if (file) {
                    const path = `receipts/${Date.now()}_${file.name}`;
                    const { error: upErr } = await _supabase.storage.from('receipts').upload(path, file);
                    if (upErr) throw upErr;
                    receiptUrl = _supabase.storage.from('receipts').getPublicUrl(path).data.publicUrl;
                }

                const { error } = await _supabase.from('studio_expenses').insert([{
                    date: document.getElementById('expDate').value,
                    amount: parseFloat(document.getElementById('expAmount').value),
                    category: document.getElementById('expCategory').value,
                    description: document.getElementById('expDesc').value,
                    reciept_url: receiptUrl
                }]);

                if (error) throw error;
                closeExpenseModal();
                renderfinancials();
            } catch (err) {
                alert(err.message);
            } finally {
                btn.disabled = false;
                btn.innerText = "Save Expense ‚ô°";
            }
        }

        // Initialize on load
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(renderfinancials, 500); 
        });

        async function deleteExpense(id, receiptUrl) {
    if (!confirm("Are you sure you want to delete this expense? This cannot be undone. üå∏")) return;

    try {
        // 1. If there's a receipt, delete it from Storage first
        if (receiptUrl) {
            // Extract the filename from the URL
            const urlParts = receiptUrl.split('/');
            const fileName = urlParts[urlParts.length - 1];
            const filePath = `receipts/${fileName}`;

            const { error: storageError } = await _supabase.storage
                .from('receipts')
                .remove([filePath]);
            
            if (storageError) console.warn("Storage cleanup failed, but proceeding with DB delete:", storageError);
        }

        // 2. Delete from the Database
        const { error } = await _supabase
            .from('studio_expenses')
            .delete()
            .eq('id', id);

        if (error) throw error;

        // 3. Refresh the UI
        showMagicAlert("Deleted! ‚ú®", "Expense record removed.", "success");
        renderfinancials();

    } catch (err) {
        showMagicAlert("Error ‚òÅÔ∏è", err.message, "error");
    }
}

        function exportToCSV() {
    const taxYear = document.getElementById('taxYearFilter').value;
    const rows = document.querySelectorAll('#expense-tbody tr');
    
    // Check if there is data to export
    if (rows.length === 0 || rows[0].innerText.includes("No expenses")) {
        showMagicAlert("Wait! üå∏", "There's no data to export for this year.", "error");
        return;
    }

    let csvContent = "data:text/csv;charset=utf-8,Date,Category,Description,Amount,Receipt URL\n";

    rows.forEach(row => {
        const cols = row.querySelectorAll('td');
        const rowData = [
            cols[0].innerText, // Date
            cols[1].innerText, // Category
            `"${cols[2].innerText.replace(/"/g, '""')}"`, // Description (escaped)
            cols[3].innerText.replace('¬£', '').replace(',', ''), // Amount
            cols[4].querySelector('a')?.href || "No Receipt" // Receipt Link
        ];
        csvContent += rowData.join(",") + "\n";
    });

    const encodedUri = encodeURI(csvContent);
    const link = document.createElement("a");
    link.setAttribute("href", encodedUri);
    link.setAttribute("download", `HanafubukiDoll_Expenses_${taxYear}.csv`);
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
}
        function switchTab(tab) {
    const settingsPanel = document.getElementById('panel-settings');
    const taxPanel = document.getElementById('panel-tax');
    const settingsBtn = document.getElementById('tab-settings');
    const taxBtn = document.getElementById('tab-tax');

    if (tab === 'settings') {
        settingsPanel.classList.remove('hidden');
        taxPanel.classList.add('hidden');
        settingsBtn.classList.add('border-b-2', 'border-pink-500', 'text-pink-500', 'bg-pink-50/30');
        taxBtn.classList.remove('border-b-2', 'border-pink-500', 'text-pink-500', 'bg-pink-50/30');
        taxBtn.classList.add('text-gray-400');
    } else {
        settingsPanel.classList.add('hidden');
        taxPanel.classList.remove('hidden');
        taxBtn.classList.add('border-b-2', 'border-pink-500', 'text-pink-500', 'bg-pink-50/30');
        settingsBtn.classList.remove('border-b-2', 'border-pink-500', 'text-pink-500', 'bg-pink-50/30');
        settingsBtn.classList.add('text-gray-400');
    }
}
    </script>

    <div id="expenseModal" class="fixed inset-0 z-[150] hidden bg-black/40 backdrop-blur-sm flex items-center justify-center p-4">
        <div class="bg-white w-full max-w-md rounded-[2.5rem] p-8 shadow-2xl border border-pink-100">
            <h3 class="text-2xl font-black italic mb-6 text-gray-800 text-center">Log Expense ‚ô°</h3>
            <form id="expenseForm" class="space-y-4">
                <div class="grid grid-cols-2 gap-3">
                    <div>
                        <label class="text-[10px] font-black uppercase text-pink-400 ml-4 mb-1 block">Date</label>
                        <input type="date" id="expDate" class="w-full p-4 bg-gray-50 rounded-2xl border-none text-sm font-bold outline-none">
                    </div>
                    <div>
                        <label class="text-[10px] font-black uppercase text-pink-400 ml-4 mb-1 block">Amount (¬£)</label>
                        <input type="number" id="expAmount" step="0.01" class="w-full p-4 bg-gray-50 rounded-2xl border-none text-sm font-bold outline-none">
                    </div>
                </div>
                <div>
                    <label class="text-[10px] font-black uppercase text-pink-400 ml-4 mb-1 block">Category</label>
                    <select id="expCategory" class="w-full p-4 bg-gray-50 rounded-2xl border-none text-sm font-bold outline-none">
                        <option value="Materials">Materials & Supplies</option>
                        <option value="Shipping">Shipping & Packaging</option>
                        <option value="Marketing">Marketing & Fees</option>
                        <option value="Office">Office & Tech</option>
                        <option value="Travel">Travel</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                <div>
                    <label class="text-[10px] font-black uppercase text-pink-400 ml-4 mb-1 block">Description</label>
                    <input type="text" id="expDesc" class="w-full p-4 bg-gray-50 rounded-2xl border-none text-sm font-bold outline-none">
                </div>
                <div>
                    <label class="text-[10px] font-black uppercase text-pink-400 ml-4 mb-1 block">Receipt</label>
                    <input type="file" id="expFile" accept="image/*" class="text-[10px] text-gray-400 ml-4">
                </div>
                <div class="flex gap-3 pt-4">
                    <button type="button" onclick="closeExpenseModal()" class="flex-1 py-4 text-gray-400 font-black text-[10px] uppercase">Cancel</button>
                    <button type="button" id="btnSaveExpense" onclick="saveExpense()" class="flex-[2] bg-pink-500 text-white py-4 rounded-2xl font-black shadow-lg">Save Expense ‚ô°</button>
                </div>
            </form>
        </div>
    </div>
    
    <script src="global-scripts.js"></script>
    </main>
    
    <div class="fixed bottom-6 left-6 z-[100] flex flex-col items-start gap-4">
    <div id="accessMenu" class="w-80 bg-white rounded-3xl shadow-2xl border border-pink-50 overflow-hidden hidden animate-fadeIn mb-2">
        <div class="flex border-b border-pink-50">
            <button onclick="switchTab('settings')" id="tab-settings" class="flex-1 py-4 text-[10px] font-black uppercase tracking-widest text-pink-500 border-b-2 border-pink-500 bg-pink-50/30">Settings</button>
            <button onclick="switchTab('tax')" id="tab-tax" class="flex-1 py-4 text-[10px] font-black uppercase tracking-widest text-gray-400 hover:text-pink-400 transition-colors">Tax Guide</button>
            <button onclick="ComfortSettings.toggleMenu()" class="px-4 text-gray-300 hover:text-pink-500 text-2xl">&times;</button>
        </div>

        <div class="p-6">
            <div id="panel-settings" class="space-y-5">
                <label class="flex justify-between items-center cursor-pointer group">
                    <span class="text-[11px] font-bold text-gray-600 uppercase group-hover:text-pink-400 transition-colors">Dark Mode</span>
                    <input type="checkbox" id="darkToggle" onchange="ComfortSettings.update('dark-theme', this.checked)" class="w-5 h-5 accent-pink-500">
                </label>
                <label class="flex justify-between items-center cursor-pointer group">
                    <span class="text-[11px] font-bold text-gray-600 uppercase group-hover:text-pink-400 transition-colors">Reduce Motion</span>
                    <input type="checkbox" id="motionToggle" onchange="ComfortSettings.update('reduced-motion', this.checked)" class="w-5 h-5 accent-pink-500">
                </label>
                <label class="flex justify-between items-center cursor-pointer group">
                    <span class="text-[11px] font-bold text-gray-600 uppercase group-hover:text-pink-400 transition-colors">Dyslexia Font</span>
                    <input type="checkbox" id="dyslexiaToggle" onchange="ComfortSettings.update('dyslexia-mode', this.checked)" class="w-5 h-5 accent-pink-500">
                </label>
            </div>

            <div id="panel-tax" class="hidden space-y-4">
                <div class="bg-pink-50/50 p-3 rounded-xl border border-pink-100">
                    <p class="text-[10px] font-black text-pink-600 uppercase mb-1">Allowable Expenses</p>
                    <p class="text-[10px] text-gray-500 leading-tight">Deduct resin, hair, eyes, and Etsy fees from turnover. You only pay tax on <b>Profit</b>.</p>
                </div>
                <div class="bg-emerald-50/50 p-3 rounded-xl border border-emerald-100">
                    <p class="text-[10px] font-black text-emerald-600 uppercase mb-1">Trading Allowance</p>
                    <p class="text-[10px] text-gray-500 leading-tight">If gross sales are <b>under ¬£1,000/year</b>, you usually don't need to register as a Sole Trader.</p>
                </div>
                <div class="bg-blue-50/50 p-3 rounded-xl border border-blue-100">
                    <p class="text-[10px] font-black text-blue-600 uppercase mb-1">Home Office</p>
                    <p class="text-[10px] text-gray-500 leading-tight">Working from home? Use the 'Flat Rate' simplified expense to claim power/heat costs easily.</p>
                </div>
            </div>
        </div>
    </div>
    
    <button onclick="ComfortSettings.toggleMenu()" class="access-btn flex items-center gap-2 px-5 py-3 bg-white border-2 border-pink-100 rounded-full shadow-lg hover:scale-105 transition-all">
        <span>‚öôÔ∏è</span>
        <span class="text-[11px] font-black uppercase tracking-widest text-gray-700">Studio Settings</span>
    </button>
</div>
    <footer class="py-20 text-center border-t border-pink-50 bg-white/30">
    <p class="text-sm tracking-widest uppercase font-bold text-pink-400 mb-4">HanafubukiDoll Aesthetic Studio</p>
    <p class="text-gray-400 text-sm mb-6">¬© 2026 ‚Ä¢ Made with cherry blossoms and magic! üê∞üå∏üåô</p>
</footer>
</body>
</html>
